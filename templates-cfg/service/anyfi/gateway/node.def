tag:
type: txt
help: AnyFi Gateway
end:
     if [ ${COMMIT_ACTION} == DELETE ]; then
         sudo kill -TERM $(sudo cat /var/run/myfid-$VAR(@).pid) 
         sudo rm -f /etc/myfid-$VAR(@).conf
     else
         if [ -f /var/myfid-$VAR(@).pid ]; then
             sudo kill -TERM $(sudo cat /var/run/myfid-$VAR(@).pid)
         fi

         if [ -z "$VAR(controller/@)" ]; then
            echo "Error configuring AnyFi Gateway: Must specify Controller"
            exit 1
         fi

         sudo /opt/vyatta/sbin/vyatta-anyfi-gateway.pl --instance=$VAR(@) --config=/etc/myfid-$VAR(@).conf || exit 1 
         if [ -f /var/run/myfid-$VAR(@).pid ]; then
             sudo kill -TERM $(sudo cat /var/run/myfid-$VAR(@).pid)
         fi
         sudo /usr/sbin/myfid --accept-license -s $VAR(controller/@) -B -P /var/run/myfid-$VAR(@).pid /etc/myfid-$VAR(@).conf 
     fi

